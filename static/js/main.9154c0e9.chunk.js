(this["webpackJsonpsimple-chat"]=this["webpackJsonpsimple-chat"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),a=n(10),o=n.n(a),r=(n(17),n(12)),i=n(2),u=(n(18),n(9)),l=n.n(u),d=n(11);n(20),n(3);function b(){var e=localStorage.getItem("vlkzmn_chat_user");return JSON.parse(e)}var j=new WebSocket("wss://chat-api-kmfo.onrender.com"),m=n(0),O=function(e){var t=e.room,n=e.setLoading,c=b().id,a=Object(s.useState)(!1),o=Object(i.a)(a,2),r=o[0],u=o[1],O=Object(s.useState)(!1),f=Object(i.a)(O,2),v=f[0],x=f[1],h=Object(s.useState)(""),g=Object(i.a)(h,2),N=g[0],p=g[1],S=Object(s.useState)(""),y=Object(i.a)(S,2),_=y[0],k=y[1],C=Object(s.useRef)(null);Object(s.useEffect)((function(){(null===t||void 0===t?void 0:t.title)&&k(null===t||void 0===t?void 0:t.title),x(!1),u(!1),p("")}),[t]);var w=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(!0);case 2:null===(t=C.current)||void 0===t||t.focus();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"header",children:[Object(m.jsx)("h1",{className:"header__title",children:_}),c===(null===t||void 0===t?void 0:t.author)&&Object(m.jsxs)("div",{className:"header__buttons",children:[r&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("form",{className:"header__form",onSubmit:function(e){var s;if(e.preventDefault(),!N.trim())return null===(s=C.current)||void 0===s||s.focus(),void p("");var c={action:"renameRoom",roomId:null===t||void 0===t?void 0:t.id,newTitle:N};n(!0),j.send(JSON.stringify(c)),u(!1),p("")},children:[Object(m.jsx)("input",{ref:C,type:"text",className:"input",placeholder:"Enter new name",value:N,onChange:function(e){p(e.target.value)}}),Object(m.jsx)("button",{type:"submit",className:"button",children:"Confirm"})]}),Object(m.jsx)("button",{type:"button",className:"button",onClick:function(){u(!1),p("")},children:"Cancel"})]}),v&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"header__buttons--danger",children:"Are you sure?"}),Object(m.jsx)("button",{type:"button",className:"button",onClick:function(){var e={action:"deleteRoom",roomId:null===t||void 0===t?void 0:t.id};n(!0),j.send(JSON.stringify(e)),x(!1)},children:"Confirm Delete"}),Object(m.jsx)("button",{type:"button",className:"button",onClick:function(){return x(!1)},children:"Cancel"})]}),!r&&!v&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{type:"button",className:"button",onClick:w,children:"Rename Room"}),Object(m.jsx)("button",{type:"button",className:"button",onClick:function(){return x(!0)},children:"Delete Room"})]})]})]})},f=(n(22),function(e){var t=e.setLoading,n=Object(s.useState)(""),c=Object(i.a)(n,2),a=c[0],o=c[1],r=Object(s.useRef)(null);return Object(m.jsxs)("form",{className:"create",onSubmit:function(e){var n;if(e.preventDefault(),!a.trim())return o(""),void(null===(n=r.current)||void 0===n||n.focus());var s=b().id,c={action:"createRoom",title:a,userId:s};t(!0),j.send(JSON.stringify(c)),o("")},children:[Object(m.jsx)("input",{ref:r,className:"input",placeholder:"Enter new room name",value:a,onChange:function(e){o(e.target.value)}}),Object(m.jsx)("button",{type:"submit",className:"button",children:"Create New Room"})]})}),v=n(6),x=n.n(v),h=(n(23),function(e){var t=e.roomsList,n=e.selectedRoom,s=e.setLoading;return Object(m.jsx)("div",{className:"rooms_list",children:t.map((function(e){return Object(m.jsx)("button",{type:"button",className:x()("button is-white rooms_list__button",{"is-info":e.id===(null===n||void 0===n?void 0:n.id)}),onClick:function(){return function(e){var t={action:"chooseRoom",id:e.id};s(!0),j.send(JSON.stringify(t))}(e)},children:e.title},e.id)}))})}),g=(n(24),function(e){var t=e.room,n=e.user,c=Object(s.useState)(""),a=Object(i.a)(c,2),o=a[0],r=a[1],u=Object(s.useRef)(null);Object(s.useEffect)((function(){var e;null===(e=u.current)||void 0===e||e.focus()}),[t]);return Object(m.jsxs)("form",{className:"send_message",onSubmit:function(e){var s,c;if(e.preventDefault(),!o.trim())return null===(c=u.current)||void 0===c||c.focus(),void r("");var a={action:"newMessage",roomId:null===t||void 0===t?void 0:t.id,author:n.name,date:Date.now(),text:o};j.send(JSON.stringify(a)),r(""),null===(s=u.current)||void 0===s||s.focus()},children:[Object(m.jsx)("input",{className:"input",ref:u,placeholder:"Message",value:o,onChange:function(e){r(e.target.value)}}),Object(m.jsx)("button",{type:"submit",className:"button",children:"Send"})]})}),N=n(31),p=(n(25),function(e){var t=e.messages,n=e.user,c=Object(s.useRef)(null);return Object(s.useEffect)((function(){c.current&&c.current.scrollIntoView({block:"end"})}),[t]),Object(m.jsxs)("div",{className:"messages",children:[Object(m.jsx)("div",{className:"messages__content",children:t.map((function(e){var t=new Date(e.date),s=Object(N.a)(t,"dd-MM-yyyy HH:mm");return Object(m.jsxs)("div",{className:x()("box messages__box",{messages__client:e.author===n.name}),children:[Object(m.jsx)("div",{className:"messages__name",children:e.author}),e.text,Object(m.jsx)("div",{className:"messages__time",children:s})]},e.date)}))}),Object(m.jsx)("div",{id:"box",ref:c})]})}),S=(n(26),function(e){var t=e.setLoading,n=Object(s.useState)(""),c=Object(i.a)(n,2),a=c[0],o=c[1],r=Object(s.useRef)(null);Object(s.useEffect)((function(){var e;null===(e=r.current)||void 0===e||e.focus()}),[]);return Object(m.jsxs)("div",{className:"modal is-active",children:[Object(m.jsx)("div",{className:"modal-background"}),Object(m.jsx)("div",{className:"modal-content",children:Object(m.jsxs)("div",{className:"box box-modal",children:[Object(m.jsx)("h1",{className:"box-title",children:"Welcome to Chat!"}),Object(m.jsx)("p",{className:"box-text",children:"For join enter yor name"}),Object(m.jsxs)("form",{className:"field box-field",onSubmit:function(e){var n;if(e.preventDefault(),!a.trim())return null===(n=r.current)||void 0===n||n.focus(),void o("");var s={action:"registration",name:a.trim()};t(!0),j.send(JSON.stringify(s))},children:[Object(m.jsx)("div",{className:"control",children:Object(m.jsx)("input",{ref:r,className:"input",typeof:"text",placeholder:"Your name",value:a,onChange:function(e){o(e.target.value)}})}),Object(m.jsx)("button",{type:"submit",className:"button is-success",children:"Join"})]})]})})]})}),y=(n(27),function(){return Object(m.jsx)("div",{className:"modal is-active",children:Object(m.jsx)("div",{className:"loader"})})}),_=(n(28),function(e){var t=e.setErrorMessage,n=e.errorMessage;return Object(m.jsxs)("div",{className:"modal is-active",children:[Object(m.jsx)("div",{className:"modal-background"}),Object(m.jsx)("div",{className:"modal-content",children:Object(m.jsxs)("div",{className:"box box-modal",children:[Object(m.jsx)("h1",{className:"box-title",children:"Error!"}),Object(m.jsx)("p",{className:"box-text",children:n}),Object(m.jsx)("button",{type:"button",className:"button is-danger",onClick:function(){return t("")},children:"Close"})]})})]})}),k=function(){var e=Object(s.useState)(b()),t=Object(i.a)(e,2),n=t[0],c=t[1],a=Object(s.useState)(!n),o=Object(i.a)(a,2),u=o[0],l=o[1],d=Object(s.useState)([]),v=Object(i.a)(d,2),x=v[0],N=v[1],k=Object(s.useState)([]),C=Object(i.a)(k,2),w=C[0],R=C[1],J=Object(s.useState)(null),L=Object(i.a)(J,2),E=L[0],M=L[1],D=Object(s.useState)(!1),I=Object(i.a)(D,2),F=I[0],z=I[1],H=Object(s.useState)(""),W=Object(i.a)(H,2),A=W[0],B=W[1];return Object(s.useEffect)((function(){return n&&(z(!0),j.onopen=function(){j.send(JSON.stringify({action:"askRoomsList"}))}),j.onmessage=function(e){var t=JSON.parse(e.data);switch(t.action){case"confirmation":l(!1);var n={name:t.name,id:t.id};c(n),localStorage.setItem("vlkzmn_chat_user",JSON.stringify(n)),j.send(JSON.stringify({action:"askRoomsList"}));break;case"roomsList":N(t.rooms),z(!1);break;case"messages":t.messages&&R(t.messages),M(t.room),z(!1);break;case"newMessage":R((function(e){return[].concat(Object(r.a)(e),[t.message])}));break;case"error":B(t.message),console.error(t.error)}},j.onclose=function(){B("Connection is break, try reload page")},j.onerror=function(){B("Error conection, try reload page")},function(){return j.close()}}),[]),Object(m.jsxs)("div",{className:"app",children:[F&&Object(m.jsx)(y,{}),A&&Object(m.jsx)(_,{errorMessage:A,setErrorMessage:B}),Object(m.jsxs)("div",{className:"app__sidebar",children:[Object(m.jsx)(f,{setLoading:z}),Object(m.jsx)(h,{roomsList:x,selectedRoom:E,setLoading:z})]}),Object(m.jsx)("div",{className:"app__main",children:E&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(O,{room:E,setLoading:z}),Object(m.jsx)(p,{messages:w,user:n}),Object(m.jsx)(g,{room:E,user:n})]})}),u&&Object(m.jsx)(S,{setLoading:z})]})};o.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(k,{})}),document.getElementById("root"))}],[[29,1,2]]]);
//# sourceMappingURL=main.9154c0e9.chunk.js.map